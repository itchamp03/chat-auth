<!DOCTYPE html>
<html>
<head>
  <title>sprout-investing</title>
  <link rel="stylesheet" href="../styles/profile.css">
  <link rel="stylesheet" href="../styles/sidebar.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="../config.js"></script>
</head>
<body>
    <h1>Profile</h1>
    <div class="profile-section" id="profile-section" style="display:none;">
        <div class="profile-details">
            <h2 id="profile-name"></h2>
            <p id="profile-email"></p>
            <p id="profile-joined"></p>
        </div>
    </div>
    <button id="logoutBtn" title="log out">âŽ‹</button>
    <div id="profile-loading">Loading...</div>
  <nav class="sidebar">
    <ul>
      <li>
        <a href="dashboard.html" title="Dashboard">
          <!-- Dashboard (Squares) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7" rx="2"/>
            <rect x="14" y="3" width="7" height="7" rx="2"/>
            <rect x="14" y="14" width="7" height="7" rx="2"/>
            <rect x="3" y="14" width="7" height="7" rx="2"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="portfolio.html" title="My Portfolio">
          <!-- Portfolio (Folder) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 7a2 2 0 0 1 2-2h3l2 3h9a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="trade.html" title="Trade">
          <!-- Trade (Arrows) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="17 1 21 5 17 9"/>
            <path d="M21 5H3"/>
            <polyline points="7 23 3 19 7 15"/>
            <path d="M3 19h18"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="research.html" title="Research">
          <!-- Research (Magnifying Glass) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="learn.html" title="Learn">
          <!-- Learn (Book) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 19.5A2.5 2.5 0 0 1 4.5 17H20"/>
            <path d="M2 4.5A2.5 2.5 0 0 1 4.5 2H20v20H4.5A2.5 2.5 0 0 1 2 19.5z"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="stats.html" title="Stats">
          <!-- Stats (Bar Chart) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="leaderboard.html" title="Leaderboard">
          <!-- Leaderboard (Trophy) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 21h8"/>
            <path d="M12 17v4"/>
            <path d="M7 4h10v7a5 5 0 0 1-10 0z"/>
            <path d="M17 4a5 5 0 0 0 5 5"/>
            <path d="M7 4a5 5 0 0 1-5 5"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="profile.html" title="Profile">
          <!-- Profile (User) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="7" r="4"/>
            <path d="M5.5 21a8.38 8.38 0 0 1 13 0"/>
          </svg>
        </a>
      </li>
      <li>
        <a href="settings.html" title="Settings">
          <!-- Settings (Gear) -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </a>
      </li>
    </ul>
  </nav>    
    <script>
      // Initialize Supabase using config.js variables
      const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function loadProfile() {
        const { data, error } = await supabaseClient.auth.getUser();
        if (error || !data || !data.user) {
          document.getElementById('profile-loading').innerText = 'Not logged in.';
          return;
        }
        const user = data.user;

        // Fetch username from your custom table (e.g., 'profiles')
        let username = 'No Username';
        const { data: profile, error: profileError } = await supabaseClient
          .from('profiles')
          .select('username')
          .eq('id', user.id) // <-- use 'id' instead of 'uuid'
          .single();

        if (profile && profile.username) {
          username = profile.username;
        }

        document.getElementById('profile-section').style.display = 'flex';
        document.getElementById('profile-loading').style.display = 'none';
        document.getElementById('profile-name').innerText = username;
        document.getElementById('profile-email').innerText = user.email;
        document.getElementById('profile-joined').innerText = 'Joined: ' + new Date(user.created_at).toLocaleDateString();
      }

      loadProfile();
    </script>
</body>
</html>